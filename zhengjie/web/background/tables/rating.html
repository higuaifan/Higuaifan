
<div class="rating">
    <table class="ui single line table">
        <thead>
        <tr>
            <th>用户</th>
            <th>评分</th>
        </tr>
        </thead>
        <tbody id="rateTbody">


        </tbody>
    </table>
    <button class="ui primary button" id="saveRate">
        Save
    </button>
</div>

<script>
    var getStars = function (dom) {
        return dom.children('.active').length;
    };


    var appendTr = function (data) {
        var tr = document.createElement('tr');
        tr.innerHTML = '<td data-id="' + data.id + '">' +
            '<h4 class="ui image header">' +
            '<img src="' + data.pic + '" class="ui mini rounded image">' +
            '<div class="content">' +
            data.real_name +
            '<div class="sub header">' + data.user_name + '</div>' +
            '</div>' +
            '</h4>' +
            '</td>' +
            '<td>' +
            '<div class="ui rating"></div>' +
            '</td>';
        return tr;
    };

    $.get('/student/index', function (data) {
        for (var i = 0; i < data.length; i++) {
            $('#rateTbody').append(appendTr(data[i]));
        }
        $('.ui.rating').rating({
            initialRating: 0,
            maxRating: 5
        });
    });

    $("#saveRate").click(function () {

        //todo 等待

        var list = $('.ui.rating');
        var count = 0;
        for (var i = 0; i < list.length; i++) {
            var id = $(list[i]).parent().prev()[0].getAttribute('data-id');
            var obj = {rater: id - 0, score: getStars($(list[i]))};
            $.ajax({
                type: 'post',
                url: '/rate/insert',
                data: obj,
                async: false,
                success: function (res) {
                    count++;
                }
            });
        }
        if (count === list.length) {
            swal('评价成功');
        } else {
            swal('评价失败');
        }
    });

</script>